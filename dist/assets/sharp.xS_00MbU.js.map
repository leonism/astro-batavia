{"version":3,"file":"sharp.xS_00MbU.js","sources":["../../node_modules/astro/dist/assets/services/sharp.js"],"sourcesContent":["import { AstroError, AstroErrorData } from \"../../core/errors/index.js\";\nimport {\n  baseService,\n  parseQuality\n} from \"./service.js\";\nlet sharp;\nconst qualityTable = {\n  low: 25,\n  mid: 50,\n  high: 80,\n  max: 100\n};\nasync function loadSharp() {\n  let sharpImport;\n  try {\n    sharpImport = (await import(\"sharp\")).default;\n  } catch {\n    throw new AstroError(AstroErrorData.MissingSharp);\n  }\n  sharpImport.cache(false);\n  return sharpImport;\n}\nconst fitMap = {\n  fill: \"fill\",\n  contain: \"inside\",\n  cover: \"cover\",\n  none: \"outside\",\n  \"scale-down\": \"inside\",\n  outside: \"outside\",\n  inside: \"inside\"\n};\nconst sharpService = {\n  validateOptions: baseService.validateOptions,\n  getURL: baseService.getURL,\n  parseURL: baseService.parseURL,\n  getHTMLAttributes: baseService.getHTMLAttributes,\n  getSrcSet: baseService.getSrcSet,\n  async transform(inputBuffer, transformOptions, config) {\n    if (!sharp) sharp = await loadSharp();\n    const transform = transformOptions;\n    if (transform.format === \"svg\") return { data: inputBuffer, format: \"svg\" };\n    const result = sharp(inputBuffer, {\n      failOnError: false,\n      pages: -1,\n      limitInputPixels: config.service.config.limitInputPixels\n    });\n    result.rotate();\n    const withoutEnlargement = Boolean(transform.fit);\n    if (transform.width && transform.height && transform.fit) {\n      const fit = fitMap[transform.fit] ?? \"inside\";\n      result.resize({\n        width: Math.round(transform.width),\n        height: Math.round(transform.height),\n        fit,\n        position: transform.position,\n        withoutEnlargement\n      });\n    } else if (transform.height && !transform.width) {\n      result.resize({\n        height: Math.round(transform.height),\n        withoutEnlargement\n      });\n    } else if (transform.width) {\n      result.resize({\n        width: Math.round(transform.width),\n        withoutEnlargement\n      });\n    }\n    if (transform.format) {\n      let quality = void 0;\n      if (transform.quality) {\n        const parsedQuality = parseQuality(transform.quality);\n        if (typeof parsedQuality === \"number\") {\n          quality = parsedQuality;\n        } else {\n          quality = transform.quality in qualityTable ? qualityTable[transform.quality] : void 0;\n        }\n      }\n      const isGifInput = inputBuffer[0] === 71 && // 'G'\n      inputBuffer[1] === 73 && // 'I'\n      inputBuffer[2] === 70 && // 'F'\n      inputBuffer[3] === 56 && // '8'\n      (inputBuffer[4] === 57 || inputBuffer[4] === 55) && // '9' or '7'\n      inputBuffer[5] === 97;\n      if (transform.format === \"webp\" && isGifInput) {\n        result.webp({ quality: typeof quality === \"number\" ? quality : void 0, loop: 0 });\n      } else {\n        result.toFormat(transform.format, { quality });\n      }\n    }\n    const { data, info } = await result.toBuffer({ resolveWithObject: true });\n    return {\n      data,\n      format: info.format\n    };\n  }\n};\nvar sharp_default = sharpService;\nexport {\n  sharp_default as default\n};\n"],"names":["AstroErrorData.MissingSharp"],"mappings":";;;AAKA,GAAA,CAAI,KAAK,CAAA;AACT,KAAA,CAAM,YAAY,CAAA,CAAA,CAAG,CAAA;AACrB,CAAA,CAAE,GAAG,EAAE,EAAE,CAAA;AACT,CAAA,CAAE,GAAG,EAAE,EAAE,CAAA;AACT,CAAA,CAAE,IAAI,EAAE,EAAE,CAAA;AACV,CAAA,CAAE,GAAG,CAAA,CAAE,GAAA;AACP,CAAC,CAAA;AACD,KAAA,CAAA,QAAA,CAAe,SAAS,CAAA,CAAA,CAAG,CAAA;AAC3B,CAAA,CAAE,IAAI,WAAW,CAAA;AACjB,CAAA,CAAE,GAAA,CAAI,CAAA;AACN,CAAA,CAAA,CAAA,CAAI,WAAW,GAAG,CAAC,KAAA,CAAM,OAAO,CAAA,KAAA,CAAO,CAAC,EAAE,OAAO,CAAA;AACjD,CAAA,CAAA,CAAG,CAAC,KAAA,CAAM,CAAA;AACV,CAAA,CAAA,CAAA,CAAI,KAAA,CAAM,GAAA,CAAI,UAAU,CAACA,YAA2B,CAAC,CAAA;AACrD,CAAA,CAAA,CAAA;AACA,CAAA,CAAE,WAAW,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;AAC1B,CAAA,CAAE,OAAO,WAAW,CAAA;AACpB,CAAA;AACA,KAAA,CAAM,MAAM,CAAA,CAAA,CAAG,CAAA;AACf,CAAA,CAAE,IAAI,EAAE,CAAA,IAAA,CAAM,CAAA;AACd,CAAA,CAAE,OAAO,EAAE,CAAA,MAAA,CAAQ,CAAA;AACnB,CAAA,CAAE,KAAK,EAAE,CAAA,KAAA,CAAO,CAAA;AAChB,CAAA,CAAE,IAAI,EAAE,CAAA,OAAA,CAAS,CAAA;AACjB,CAAA,CAAE,CAAA,KAAA,CAAA,IAAA,CAAY,EAAE,CAAA,MAAA,CAAQ,CAAA;AACxB,CAAA,CAAE,OAAO,EAAE,CAAA,OAAA,CAAS,CAAA;AACpB,CAAA,CAAE,MAAM,CAAA,CAAE,CAAA,MAAA,CAAA;AACV,CAAC,CAAA;AACD,KAAA,CAAM,YAAY,CAAA,CAAA,CAAG,CAAA;AACrB,CAAA,CAAE,eAAe,CAAA,CAAE,WAAW,CAAC,eAAe,CAAA;AAC9C,CAAA,CAAE,MAAM,CAAA,CAAE,WAAW,CAAC,MAAM,CAAA;AAC5B,CAAA,CAAE,QAAQ,CAAA,CAAE,WAAW,CAAC,QAAQ,CAAA;AAChC,CAAA,CAAE,iBAAiB,CAAA,CAAE,WAAW,CAAC,iBAAiB,CAAA;AAClD,CAAA,CAAE,SAAS,CAAA,CAAE,WAAW,CAAC,SAAS,CAAA;AAClC,CAAA,CAAE,KAAA,CAAM,SAAS,CAAC,WAAW,EAAE,gBAAgB,CAAA,CAAE,MAAM,CAAA,CAAE,CAAA;AACzD,CAAA,CAAA,CAAA,CAAI,EAAA,CAAA,CAAI,CAAC,KAAK,CAAA,CAAE,KAAK,CAAA,CAAA,CAAG,KAAA,CAAM,SAAS,CAAA,CAAE,CAAA;AACzC,CAAA,CAAA,CAAA,CAAI,KAAA,CAAM,SAAS,CAAA,CAAA,CAAG,gBAAgB,CAAA;AACtC,CAAA,CAAA,CAAA,CAAI,IAAI,SAAS,CAAC,MAAM,CAAA,CAAA,CAAA,CAAA,CAAK,KAAK,CAAA,CAAE,MAAA,CAAO,CAAA,CAAE,IAAI,EAAE,WAAW,CAAA,CAAE,MAAM,CAAA,CAAE,KAAK,CAAA,CAAE,CAAA;AAC/E,CAAA,CAAA,CAAA,CAAI,MAAM,MAAM,CAAA,CAAA,CAAG,KAAK,CAAC,WAAW,CAAA,CAAE,CAAA;AACtC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,WAAW,EAAE,KAAK,CAAA;AACxB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,KAAK,EAAE,CAAA,CAAE,CAAA;AACf,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,gBAAgB,CAAA,CAAE,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,gBAAA;AAC9C,CAAA,CAAA,CAAA,CAAA,CAAK,CAAC,CAAA;AACN,CAAA,CAAA,CAAA,CAAI,MAAM,CAAC,MAAM,CAAA,CAAE,CAAA;AACnB,CAAA,CAAA,CAAA,CAAI,KAAA,CAAM,kBAAkB,CAAA,CAAA,CAAG,OAAO,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA;AACrD,CAAA,CAAA,CAAA,CAAI,EAAA,CAAA,CAAI,SAAS,CAAC,KAAK,CAAA,CAAA,CAAA,CAAI,SAAS,CAAC,MAAM,CAAA,CAAA,CAAA,CAAI,SAAS,CAAC,GAAG,CAAA,CAAE,CAAA;AAC9D,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,KAAA,CAAM,GAAG,CAAA,CAAA,CAAG,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,CAAA,CAAA,CAAA,CAAI,CAAA,MAAA,CAAQ,CAAA;AACnD,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,MAAM,CAAC,MAAM,CAAC,CAAA;AACpB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,CAAA;AAC1C,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,CAAA;AAC5C,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,GAAG,CAAA;AACX,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,QAAQ,CAAA,CAAE,SAAS,CAAC,QAAQ,CAAA;AACpC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,kBAAA;AACR,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAO,CAAC,CAAA;AACR,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,IAAA,CAAM,EAAA,CAAA,CAAI,SAAS,CAAC,MAAM,IAAI,CAAC,SAAS,CAAC,KAAK,CAAA,CAAE,CAAA;AACrD,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,MAAM,CAAC,MAAM,CAAC,CAAA;AACpB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,MAAM,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,CAAA;AAC5C,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,kBAAA;AACR,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAO,CAAC,CAAA;AACR,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA,IAAA,CAAM,EAAA,CAAA,CAAI,SAAS,CAAC,KAAK,CAAA,CAAE,CAAA;AAChC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,MAAM,CAAC,MAAM,CAAC,CAAA;AACpB,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,KAAK,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,KAAK,CAAC,CAAA;AAC1C,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,kBAAA;AACR,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAO,CAAC,CAAA;AACR,CAAA,CAAA,CAAA,CAAA,CAAA;AACA,CAAA,CAAA,CAAA,CAAI,EAAA,CAAA,CAAI,SAAS,CAAC,MAAM,CAAA,CAAE,CAAA;AAC1B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,GAAA,CAAI,OAAO,CAAA,CAAA,CAAG,IAAA,CAAA,CAAM,CAAA;AAC1B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,EAAA,CAAA,CAAI,SAAS,CAAC,OAAO,CAAA,CAAE,CAAA;AAC7B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,KAAA,CAAM,aAAa,CAAA,CAAA,CAAG,YAAY,CAAC,SAAS,CAAC,OAAO,CAAC,CAAA;AAC7D,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,EAAA,CAAA,CAAI,MAAA,CAAO,aAAa,CAAA,CAAA,CAAA,CAAA,CAAK,QAAQ,CAAA,CAAE,CAAA;AAC/C,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,OAAO,GAAG,aAAa,CAAA;AACjC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAS,CAAA,IAAA,CAAM,CAAA;AACf,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAU,OAAO,CAAA,CAAA,CAAG,SAAS,CAAC,OAAO,CAAA,EAAA,CAAI,YAAY,CAAA,CAAA,CAAG,YAAY,CAAC,SAAS,CAAC,OAAO,CAAC,GAAG,IAAA,CAAA,CAAM,CAAA;AAChG,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AACA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AACA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,KAAA,CAAM,UAAU,CAAA,CAAA,CAAG,WAAW,CAAC,CAAC,CAAC,KAAK,EAAE,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AAC9C,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,WAAW,CAAC,CAAC,CAAC,KAAK,EAAE,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AAC3B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,WAAW,CAAC,CAAC,CAAC,KAAK,EAAE,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AAC3B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,WAAW,CAAC,CAAC,CAAC,KAAK,EAAE,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AAC3B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAO,WAAW,CAAC,CAAC,CAAC,CAAA,CAAA,CAAA,CAAA,CAAK,EAAE,CAAA,CAAA,CAAA,CAAI,WAAW,CAAC,CAAC,CAAC,CAAA,CAAA,CAAA,CAAA,CAAK,EAAE,CAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,EAAA,CAAA,CAAA,CAAA,CAAA;AACtD,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,WAAW,CAAC,CAAC,CAAC,KAAK,EAAE,CAAA;AAC3B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,EAAA,CAAA,CAAI,SAAS,CAAC,MAAM,KAAK,CAAA,IAAA,CAAM,CAAA,CAAA,CAAA,CAAI,UAAU,CAAA,CAAE,CAAA;AACrD,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,MAAM,CAAC,IAAI,CAAC,EAAE,OAAO,CAAA,CAAE,OAAO,OAAO,CAAA,CAAA,CAAA,CAAA,CAAK,QAAQ,CAAA,CAAA,CAAG,OAAO,GAAG,IAAA,CAAA,CAAM,CAAA,CAAE,IAAI,CAAA,CAAE,CAAC,EAAE,CAAC,CAAA;AACzF,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAO,CAAA,IAAA,CAAM,CAAA;AACb,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,MAAM,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,CAAA,CAAE,CAAA,CAAE,OAAO,CAAA,CAAE,CAAC,CAAA;AACtD,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA;AACA,CAAA,CAAA,CAAA,CAAA,CAAA;AACA,CAAA,CAAA,CAAA,CAAI,MAAM,CAAA,CAAE,IAAI,CAAA,CAAE,IAAI,EAAE,CAAA,CAAA,CAAG,KAAA,CAAM,MAAM,CAAC,QAAQ,CAAC,CAAA,CAAE,iBAAiB,CAAA,CAAE,IAAI,EAAE,CAAC,CAAA;AAC7E,CAAA,CAAA,CAAA,CAAI,MAAA,CAAO,CAAA;AACX,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,IAAI,CAAA;AACV,CAAA,CAAA,CAAA,CAAA,CAAA,CAAM,MAAM,CAAA,CAAE,IAAI,CAAC,MAAA;AACnB,CAAA,CAAA,CAAA,CAAA,CAAK,CAAA;AACL,CAAA,CAAA,CAAA;AACA,CAAC,CAAA;AACE,GAAA,CAAC,aAAa,CAAA,CAAA,CAAG,YAAA,CAAA;;","x_google_ignoreList":[0]}