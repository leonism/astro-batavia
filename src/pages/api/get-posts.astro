---
import BlogCard from '@/components/blog/BlogCard.astro';
import { BlogService } from '@/services/BlogService';
import { PAGINATION_POSTS_PER_PAGE } from '@/consts';

const url = Astro.url;
const page = parseInt(url.searchParams.get('page') || '1', 10);
const lang = url.searchParams.get('lang') || 'en';
const tag = url.searchParams.get('tag');

let sortedPosts;
if (tag) {
  sortedPosts = await BlogService.getPostsByTag(lang, tag);
} else {
  sortedPosts = await BlogService.getPostsByLang(lang);
}

const postsPerPage = PAGINATION_POSTS_PER_PAGE;
const startIndex = (page - 1) * postsPerPage;
const postsToDisplay = sortedPosts.slice(startIndex, startIndex + postsPerPage);
---

{postsToDisplay.map((post) => (
  <div class="post-item animate-fade-in">
    <BlogCard post={post} lang={lang} />
  </div>
))}
