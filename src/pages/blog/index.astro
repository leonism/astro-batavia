---
import Layout from "@/layouts/Layout.astro";
import { useTranslations } from "@/i18n/utils";
import { languages } from "@/i18n/ui";
import {
  getSortedEnglishPosts,
  getAllUniqueTags,
  POSTS_PER_PAGE,
  type Post,
} from "@/features/blog/blogData";

import BlogPageHeader from "@/components/blog/BlogPageHeader.astro";
import BlogStats from "@/components/blog/BlogStats.astro";
import TagFilter from "@/components/blog/TagFilter.astro";
import PostGrid from "@/components/blog/PostGrid.astro";
import LoadMoreButton from "@/components/blog/LoadMoreButton.astro";

const lang = "en" as keyof typeof languages; // Ensure lang is of the correct type
const t = useTranslations(lang);

const posts: Post[] = await getSortedEnglishPosts();
const allTags: string[] = getAllUniqueTags(posts);

const pageTitle = `${t("nav.blog")} | Astro Batavia`;
const pageDescription =
  "Discover articles about web development, technology, and more";
---

<Layout
  title={pageTitle}
  description={pageDescription}
  lang={lang}>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <BlogPageHeader
      title={t("nav.blog")}
      description="Explore our collection of articles covering web development, technology trends, and insights."
    />

    <BlogStats
      postCount={posts.length}
      tagCount={allTags.length}
    />

    <TagFilter tags={allTags} />

    <PostGrid
      posts={posts}
      lang={lang}
    />

    <LoadMoreButton show={posts.length > POSTS_PER_PAGE} />
  </div>
</Layout>
