---
import Layout from '@/layouts/Layout.astro';
import HeroSection from '@/components/sections/HeroSection.astro';
import FeaturesSection from '@/components/sections/FeaturesSection.astro';
import FeaturedStoriesSection from '@/components/sections/FeaturedStoriesSection.astro';
import NewsletterSection from '@/components/sections/NewsletterSection.astro';
import { useTranslations, isValidLanguage } from '@/i18n/utils';
import { SITE_TITLE } from '@/consts';
import { BlogService } from '@/services/BlogService';

export async function getStaticPaths() {
  return [{ params: { lang: 'es' } }, { params: { lang: 'ja' } }];
}

const { lang } = Astro.params;

// Validate language
if (!lang || !isValidLanguage(lang)) {
  return Astro.redirect('/404');
}

const t = useTranslations(lang);

// Get latest blog posts for this language using BlogService
const latestPosts = await BlogService.getLatestPosts(lang, 3);
---

<Layout
  title={`${SITE_TITLE} - Modern Multi-Language Blog`}
  description={t('meta.description')}
  lang={lang}
>
  <HeroSection />
  <FeaturesSection />
  <FeaturedStoriesSection latestPosts={latestPosts} />
  <NewsletterSection />
</Layout>
