---
import { getLocalizedPath, useTranslations } from "@/i18n/utils";
import type { LanguageKey } from "@/i18n/types";

interface NavLink {
  href: string;
  textKey:
    | "nav.home"
    | "nav.blog"
    | "nav.services"
    | "nav.about"
    | "nav.contact"
    | "nav.search";
  icon: string; // Lucide-inspired SVG path
  checkStartsWith?: boolean;
}

interface Props {
  lang: LanguageKey;
  currentPath: string;
  variant: "desktop" | "mobile";
}

const { lang, currentPath, variant } = Astro.props;
const t = useTranslations(lang);

const navLinks: NavLink[] = [
  {
    href: "/",
    textKey: "nav.home",
    icon: "M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6",
  },
  {
    href: "/blog",
    textKey: "nav.blog",
    icon: "M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6m-6 4h10",
    checkStartsWith: true,
  },
  {
    href: "/services",
    textKey: "nav.services",
    icon: "M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z",
  },
  {
    href: "/about",
    textKey: "nav.about",
    icon: "M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z",
  },
  {
    href: "/contact",
    textKey: "nav.contact",
    icon: "M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z",
  },
];

const underlineBaseClass =
  "absolute -bottom-1 left-0 h-0.5 bg-blue-600 transition-all duration-300";
const baseDesktopClass =
  "font-medium transition-colors duration-200 relative group";
const activeDesktopClass = "text-blue-600 dark:text-blue-400";
const inactiveDesktopClass =
  "text-slate-600 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400";
const baseMobileClass =
  "flex items-center gap-4 px-5 py-4 text-lg font-semibold rounded-2xl transition-all duration-300 group";
const activeMobileClass =
  "text-blue-600 dark:text-blue-400 bg-blue-50/80 dark:bg-blue-900/30 backdrop-blur-md shadow-sm ring-1 ring-blue-100 dark:ring-blue-800";
const inactiveMobileClass =
  "text-slate-600 dark:text-slate-400 hover:bg-slate-50 dark:hover:bg-slate-800/50 hover:text-slate-900 dark:hover:text-white";
---

{
  navLinks.map((link) => {
    const localizedHref = getLocalizedPath(link.href, lang);
    const isActive = link.checkStartsWith
      ? currentPath.startsWith(localizedHref)
      : currentPath === localizedHref;

    if (variant === "desktop") {
      return (
        <a
          href={localizedHref}
          class={`${baseDesktopClass} ${isActive ? activeDesktopClass : inactiveDesktopClass}`}>
          {t(link.textKey as keyof typeof t)}
          <span
            class={`${underlineBaseClass} ${isActive ? "w-full" : "w-0 group-hover:w-full"}`}
          />
        </a>
      );
    } else {
      // mobile - grande & premium
      return (
        <a
          href={localizedHref}
          class:list={[
            baseMobileClass,
            isActive ? activeMobileClass : inactiveMobileClass,
          ]}>
          <div class={`flex items-center justify-center w-11 h-11 rounded-xl shrink-0 transition-all duration-300 ${isActive ? 'bg-blue-600 text-white shadow-lg shadow-blue-500/30' : 'bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 group-hover:bg-blue-100 dark:group-hover:bg-blue-900/50 group-hover:text-blue-600 dark:group-hover:text-blue-400'}`}>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={link.icon}></path>
            </svg>
          </div>
          <span class="flex-1 tracking-tight">
            {t(link.textKey as keyof typeof t)}
          </span>
          <svg class={`w-5 h-5 transition-all duration-300 ${isActive ? 'translate-x-0 opacity-100 text-blue-600' : '-translate-x-2 opacity-0 group-hover:translate-x-0 group-hover:opacity-100'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </a>
      );
    }
  })
}
