---
import { getLangFromUrl, useTranslations } from '../../i18n/utils';
import SearchOverlayInput from './SearchOverlayInput.astro';
import SearchOverlaySuggestions from './SearchOverlaySuggestions.astro';
import SearchOverlayResults from './SearchOverlayResults.astro';
import SearchOverlayNoResults from './SearchOverlayNoResults.astro';
import SearchOverlayFooter from './SearchOverlayFooter.astro';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<section
  id="search-overlay"
  class="fixed inset-0 bg-white/95 dark:bg-slate-900/95 backdrop-blur-xl z-[100] p-4 hidden"
  aria-labelledby="search-overlay-title"
  role="search"
  aria-hidden="true"
>
  <h2 id="search-overlay-title" class="sr-only">Search</h2>

  <button
    id="close-search-overlay"
    class="absolute top-4 right-4 text-gray-600 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200 z-10"
    aria-label="Close search"
  >
    <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>

  <div class="w-full max-w-4xl mx-auto">
    <SearchOverlayInput />
    <SearchOverlaySuggestions />
    <SearchOverlayResults />
    <SearchOverlayNoResults />
    <SearchOverlayFooter />
  </div>
</section>

<script>
  import { EnhancedSearchUI } from '../../features/search/EnhancedSearchUI';
  new EnhancedSearchUI();
</script>

<style>
  #search-overlay {
    animation: fadeIn 0.3s ease-out forwards;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .search-highlight {
    background-color: #fef08a;
    color: #92400e;
    padding: 0.125rem 0.25rem;
    border-radius: 0.25rem;
    font-weight: 500;
  }

  .dark .search-highlight {
    background-color: #fbbf24;
    color: #92400e;
  }

  /* Custom scrollbar for results */
  #search-results-container::-webkit-scrollbar {
    width: 6px;
  }

  #search-results-container::-webkit-scrollbar-track {
    background: transparent;
  }

  #search-results-container::-webkit-scrollbar-thumb {
    background: #d1d5db;
    border-radius: 3px;
  }

  .dark #search-results-container::-webkit-scrollbar-thumb {
    background: #4b5563;
  }

  /* Keyboard navigation styles */
  .search-result-item.keyboard-focused {
    @apply ring-2 ring-primary-500 ring-opacity-50;
  }

  .suggestion-item.keyboard-focused {
    @apply ring-2 ring-primary-500 ring-opacity-50;
  }
</style>
