---
import BlogCard from '@/components/blog/BlogCard.astro'; // Assuming BlogCard is in components/blog/
import type { CollectionEntry } from 'astro:content';
import type { LanguageKey } from '@/i18n/types';

interface Props {
  posts: CollectionEntry<'blog'>[];
  lang: LanguageKey;
  noResultsText: string; // For t('search.no-results')
  initialStatusText: string; // For initial message
}

const { posts, lang, noResultsText, initialStatusText } = Astro.props;
---

<section id="search-results" class="mb-8" role="region" aria-label="Search results">
  <div
    id="search-status"
    class="mb-6 text-center text-gray-500 dark:text-gray-400"
    role="status"
    aria-live="polite"
    aria-atomic="true"
  >
    {initialStatusText}
  </div>

  <div
    id="results-container"
    class="grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3"
    role="listbox"
    aria-label="Search results list"
    tabindex="0"
  >
    {
      posts.map((post, index) => (
        <article
          class="search-result post-item rounded-lg p-4 transition-colors duration-200 focus-within:ring-2 focus-within:ring-primary-500 hover:bg-gray-50 dark:hover:bg-gray-800"
          role="option"
          aria-selected="false"
          aria-labelledby={`result-title-${index}`}
          aria-describedby={`result-excerpt-${index}`}
          data-tags={JSON.stringify(post.data.tags || [])}
          data-title={post.data.title}
          data-description={post.data.description}
          data-date={post.data.pubDate.toISOString()}
          id={`result-${index}`}
          tabindex="-1"
        >
          <BlogCard post={post} lang={lang} />
        </article>
      ))
    }
  </div>
</section>

<!-- No Results State -->
<div id="no-results" class="hidden py-12 text-center">
  <svg
    class="mx-auto mb-4 h-16 w-16 text-gray-400"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
    >
    </path>
  </svg>
  <h3 class="mb-2 text-lg font-medium text-gray-900 dark:text-gray-100">
    {noResultsText}
  </h3>
  <p class="mb-4 text-gray-500 dark:text-gray-400">
    Try adjusting your search terms or browse our topics below.
  </p>
  <button
    id="clear-search"
    class="inline-flex items-center rounded-md border border-transparent bg-primary-50 px-4 py-2 text-sm font-medium text-primary-600 transition-colors duration-200 hover:bg-primary-100 dark:bg-primary-900/20 dark:text-primary-400 dark:hover:bg-primary-900/30"
  >
    Clear Search
  </button>
</div>
